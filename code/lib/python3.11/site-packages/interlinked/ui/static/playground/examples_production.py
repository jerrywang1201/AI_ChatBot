def lookup_radar(radar_id: str, daw_token: str) -> dict[str, any]:
	"""
	Looks up a given radar and returns its title and description

	@param radar_id(str): a Radar ID (e.g. rdar://123456)
	"""

	import radarclient

	radar_client = radarclient.RadarClient(radarclient.AuthenticationStrategyWebCookie(cookie_value=daw_token),
										   radarclient.ClientSystemIdentifier('InterlinkedExample', '1.0'))

	radar = radar_client.radar_for_id(radar_id.split('/')[-1])
	return {'title': radar.title, 'description': radar.description.items()[-1].text, 'state': radar.state}


def get_person_email(name: str) -> str:
	"""
	Returns the email address of a person

	@param name(str): the name of the person
	"""
	from interlinked.core.clients.appledirectoryclient import AppleDirectoryClient
	return AppleDirectoryClient.shared.get_persons_by_name(name=name)[0].email


def send_email(to_addresses: list[str] | str, subject: str, body: str) -> str:
	"""
	Sends an email

	@param to_addresses(list): list of email addresses to send an email to
	@param subject(str): the subject of the email
	@param body(str): the body of the email
	"""

	from interlinked.core.clients.mailclient import MailClient
	MailClient.send(from_address='test@apple.com', to_addresses=to_addresses, subject=subject, body=body)


def create_vm(hardware_type: str, os_codename: str, daw_token: str) -> str:
	"""
	Creates a VM and returns the ID

	@param hardware_type(str): e.g. "Mac", "iPhone"
	@param os_codename(str): the OS code name (e.g. Lorem)
	"""

	from interlinked.core.clients.devicecomputeclient import DeviceComputeClient

	capabilities: dict = {'deviceClass': hardware_type, 'apple:reality': 'virtual', 'buildTrain': os_codename,
						  'apple:osBuild': {'program': 'macOS' if hardware_type == 'Mac' else 'iOS'}}

	# skip Buddy on macOS
	if hardware_type == 'Mac':
		capabilities['apple:macos:setup'] = {}

	elif hardware_type in {'iPadOS', 'iOS'}:
		capabilities['apple:ios:setup'] = {}

	return DeviceComputeClient(daw_token=daw_token).create_job(capabilities=capabilities)


def get_entitlements_for_name(process_name: str, session_id: str, daw_token: str) -> str:
	"""
	Returns the entitlements for a given process name. Must run create_vm first

	@param process_name(str): the name of the process
	@param session_id(str): the session ID from create_vm
	@return (str): the entitlements in XML format
	"""

	from interlinked.core.clients.devicecomputeclient import DeviceComputeClient
	return DeviceComputeClient(daw_token=daw_token).get_entitlements_for_name(process_name=process_name, session_id=session_id)
