from typing import Any, Callable, Type


class SingletonMeta(type):
	"""
	Add this class to a class via `metaclass=SingletonMeta`,
	which allows you to access a shared instance of the class via `.shared`
	"""

	_instance: Any = None

	def __call__(cls, *args, **kwargs):

		# if `shared=True` is passed, we're use the shared instance of
		# this class
		if kwargs.get('shared', False):

			kwargs.pop('shared')
			if cls._instance is None:
				cls._instance = super().__call__(*args, **kwargs)

			return cls._instance

		else:
			return super().__call__(*args, **kwargs)

	class Shared:
		"""
		Acts as a `@classmethod` + `@property`, which
		are not supported in Python 3.13+
		"""

		def __init__(self, fget: Callable, fset: Callable = None):
			self.fget = fget

		def __get__(self, instance: Any, owner: Type) -> 'Shared':
			return self.fget(owner)

		def getter(self, fn: Callable):

			self.fget = fn
			return self

